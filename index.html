<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fotos de la boda ‚Äî Mar√≠a & Jos√© üíç</title>
  <style>
    :root { --rosa:#c2185b; --fondo:#fdf6f9; }
    body { font-family: system-ui; background: var(--fondo); margin:0; padding: 32px; text-align:center; }
    h1 { color: var(--rosa); margin-bottom: 8px; }
    .box { background:#fff; border:2px dashed var(--rosa); border-radius:16px; padding:28px; display:inline-block; }
    input[type=file] { margin:16px 0; }
    button { background:var(--rosa); color:#fff; border:0; padding:12px 18px; border-radius:12px; cursor:pointer; font-weight:600; margin:8px; }
    progress { width:100%; height:14px; margin-top:12px; display:none; }
    .tip { font-size: 0.95rem; color:#666; }
  </style>
</head>
<body>
  <h1>üì∏ Fotos de la boda de Mar√≠a & Jos√©</h1>
  <p>¬°Gracias por compartir nuestros recuerdos! üíï</p>

  <div class="box">
    <p><strong>Sube desde tu galer√≠a</strong> o <strong>toma una foto</strong> directamente</p>
    <input id="fileInput" type="file" accept="image/*" multiple capture>
    <br>
    <button id="uploadBtn">Subir fotos</button>
    <progress id="progress"></progress>
    <p id="status" class="tip"></p>
  </div>

  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-storage-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCHEIj-WdSiqs2wbA4M-U_jqO5WIC6SOZo",
      authDomain: "boda-maria-y-jose.firebaseapp.com",
      projectId: "boda-maria-y-jose",
      storageBucket: "boda-maria-y-jose.firebasestorage.app",
      messagingSenderId: "453823979387",
      appId: "1:453823979387:web:90d5cc02790e97b596a7de"
    };
    firebase.initializeApp(firebaseConfig);
    const storage = firebase.storage();

    const input = document.getElementById('fileInput');
    const btn = document.getElementById('uploadBtn');
    const statusEl = document.getElementById('status');
    const progressEl = document.getElementById('progress');

    btn.addEventListener('click', async () => {
      const files = input.files;
      if (!files.length) { statusEl.textContent = 'Selecciona al menos una foto.'; return; }
      btn.disabled = true; input.disabled = true; progressEl.style.display = 'block';
      let totalBytes = Array.from(files).reduce((sum,f)=>sum+f.size,0);
      let uploadedBytes = 0;
      for (const file of files) {
        if (!file.type.startsWith('image/')) { statusEl.textContent='Solo im√°genes'; continue; }
        const path = `wedding-uploads/${Date.now()}-${file.name.replace(/\s+/g,'_')}`;
        const ref = storage.ref().child(path);
        const task = ref.put(file);
        await new Promise((resolve,reject)=>{
          task.on('state_changed', snap=>{
            const delta = snap.bytesTransferred - (ref._lastBytes||0);
            ref._lastBytes = snap.bytesTransferred;
            uploadedBytes += Math.max(delta,0);
            progressEl.value = Math.floor((uploadedBytes/totalBytes)*100);
          }, reject, resolve);
        });
      }
      statusEl.textContent = `‚úÖ Subida completada (${files.length} fotos)`;
      btn.disabled = false; input.disabled = false; input.value='';
      setTimeout(()=>{progressEl.style.display='none'; progressEl.value=0;},800);
    });
  </script>
</body>
</html>
